WARNING:root:In order to use the mouse gastrulation seqFISH datsets, please install squidpy (see https://github.com/scverse/squidpy).
WARNING:root:In order to use sagenet models, please install pytorch geometric (see https://pytorch-geometric.readthedocs.io) and 
 captum (see https://github.com/pytorch/captum).
WARNING:root:mvTCR is not installed. To use mvTCR models, please install it first using "pip install mvtcr"
WARNING:root:multigrate is not installed. To use multigrate models, please install it first using "pip install multigrate".
INFO:scarches.trainers.scpoli.trainer:GPU available: True, GPU used: True
Embedding dictionary:
 	Num conditions: [2, 23]
 	Embedding dim: [5, 5]
Encoder Architecture:
	Input Layer in, out and cond: 1014 128 10
	Mean/Var Layer in/out: 128 30
Decoder Architecture:
	First Layer in, out and cond:  30 128 10
	Output Layer in/out:  128 1014 

Initializing dataloaders
Starting training
 |--------------------| 0.0%  - val_loss:  816.43 - val_cvae_loss:  816.43 |--------------------| 0.0%  - val_loss:  739.97 - val_cvae_loss:  739.97 |--------------------| 0.0%  - val_loss:  704.14 - val_cvae_loss:  704.14 |--------------------| 0.0%  - val_loss:  705.98 - val_cvae_loss:  705.98 |--------------------| 0.0%  - val_loss:  658.55 - val_cvae_loss:  658.55 |--------------------| 0.0%  - val_loss:  648.01 - val_cvae_loss:  648.01 |--------------------| 0.0%  - val_loss:  633.16 - val_cvae_loss:  633.16 |--------------------| 0.0%  - val_loss:  637.10 - val_cvae_loss:  637.10 |--------------------| 0.0%  - val_loss:  960.02 - val_cvae_loss:  960.02 |--------------------| 0.0%  - val_loss:  645.20 - val_cvae_loss:  645.20 |--------------------| 0.0%  - val_loss:  728.31 - val_cvae_loss:  728.31 |--------------------| 0.0%  - val_loss:  632.18 - val_cvae_loss:  632.18 |--------------------| 0.0%  - val_loss:  751.95 - val_cvae_loss:  751.95 |--------------------| 0.0%  - val_loss:  780.09 - val_cvae_loss:  780.09 |--------------------| 0.0%  - val_loss:  664.53 - val_cvae_loss:  664.53 |--------------------| 0.0%  - val_loss:  613.59 - val_cvae_loss:  613.59 |--------------------| 0.0%  - val_loss:  617.54 - val_cvae_loss:  617.54 |--------------------| 0.0%  - val_loss:  598.33 - val_cvae_loss:  598.33 |--------------------| 0.0%  - val_loss:  636.25 - val_cvae_loss:  636.25 |--------------------| 0.0%  - val_loss:  613.72 - val_cvae_loss:  613.72 |--------------------| 0.0%  - val_loss:  609.66 - val_cvae_loss:  609.66 |--------------------| 0.0%  - val_loss:  603.60 - val_cvae_loss:  603.60 |--------------------| 0.0%  - val_loss:  597.99 - val_cvae_loss:  597.99 |--------------------| 0.0%  - val_loss:  594.53 - val_cvae_loss:  594.53 |--------------------| 0.0%  - val_loss:  604.03 - val_cvae_loss:  604.03 |--------------------| 0.0%  - val_loss:  680.45 - val_cvae_loss:  609.24 - val_prototype_loss:   71.21 - val_labeled_loss:  142.42 |--------------------| 0.0%  - val_loss:  652.17 - val_cvae_loss:  604.15 - val_prototype_loss:   48.02 - val_labeled_loss:   96.04 |--------------------| 0.0%  - val_loss:  712.67 - val_cvae_loss:  675.16 - val_prototype_loss:   37.51 - val_labeled_loss:   75.02 |--------------------| 0.0%  - val_loss:  688.01 - val_cvae_loss:  657.73 - val_prototype_loss:   30.29 - val_labeled_loss:   60.58 |--------------------| 0.0%  - val_loss:  654.21 - val_cvae_loss:  627.13 - val_prototype_loss:   27.09 - val_labeled_loss:   54.18 |--------------------| 0.0%  - val_loss:  633.04 - val_cvae_loss:  608.67 - val_prototype_loss:   24.37 - val_labeled_loss:   48.73 |--------------------| 0.0%  - val_loss:  645.24 - val_cvae_loss:  622.71 - val_prototype_loss:   22.53 - val_labeled_loss:   45.06 |--------------------| 0.0%  - val_loss:  620.59 - val_cvae_loss:  599.99 - val_prototype_loss:   20.61 - val_labeled_loss:   41.21 |--------------------| 0.0%  - val_loss:  652.38 - val_cvae_loss:  632.28 - val_prototype_loss:   20.10 - val_labeled_loss:   40.21 |--------------------| 0.0%  - val_loss:  700.42 - val_cvae_loss:  680.97 - val_prototype_loss:   19.45 - val_labeled_loss:   38.90 |--------------------| 0.0%  - val_loss:  624.43 - val_cvae_loss:  605.65 - val_prototype_loss:   18.78 - val_labeled_loss:   37.56 |--------------------| 0.0%  - val_loss:  664.52 - val_cvae_loss:  646.82 - val_prototype_loss:   17.70 - val_labeled_loss:   35.39 |--------------------| 0.0%  - val_loss:  636.71 - val_cvae_loss:  618.96 - val_prototype_loss:   17.74 - val_labeled_loss:   35.49 |--------------------| 0.0%  - val_loss:  625.21 - val_cvae_loss:  608.08 - val_prototype_loss:   17.13 - val_labeled_loss:   34.25 |--------------------| 0.0%  - val_loss:  846.81 - val_cvae_loss:  830.06 - val_prototype_loss:   16.75 - val_labeled_loss:   33.51 |--------------------| 0.0%  - val_loss:  613.08 - val_cvae_loss:  596.85 - val_prototype_loss:   16.23 - val_labeled_loss:   32.46 |--------------------| 0.0%  - val_loss:  625.97 - val_cvae_loss:  609.63 - val_prototype_loss:   16.34 - val_labeled_loss:   32.68 |--------------------| 0.0%  - val_loss:  619.20 - val_cvae_loss:  603.17 - val_prototype_loss:   16.02 - val_labeled_loss:   32.05 |--------------------| 0.0%  - val_loss:  625.93 - val_cvae_loss:  610.09 - val_prototype_loss:   15.84 - val_labeled_loss:   31.69 |--------------------| 0.0%  - val_loss:  630.92 - val_cvae_loss:  615.50 - val_prototype_loss:   15.42 - val_labeled_loss:   30.84 |--------------------| 0.0%  - val_loss:  646.49 - val_cvae_loss:  631.01 - val_prototype_loss:   15.48 - val_labeled_loss:   30.95 |--------------------| 0.0%  - val_loss:  675.28 - val_cvae_loss:  659.55 - val_prototype_loss:   15.73 - val_labeled_loss:   31.47 |--------------------| 0.0%  - val_loss:  616.93 - val_cvae_loss:  601.48 - val_prototype_loss:   15.45 - val_labeled_loss:   30.90 |--------------------| 0.0%  - val_loss:  620.38 - val_cvae_loss:  604.74 - val_prototype_loss:   15.64 - val_labeled_loss:   31.28 |--------------------| 0.0%  - val_loss:  623.15 - val_cvae_loss:  608.45 - val_prototype_loss:   14.70 - val_labeled_loss:   29.41 |--------------------| 0.0%  - val_loss:  650.74 - val_cvae_loss:  635.87 - val_prototype_loss:   14.86 - val_labeled_loss:   29.73 |--------------------| 0.0%  - val_loss:  612.47 - val_cvae_loss:  597.53 - val_prototype_loss:   14.95 - val_labeled_loss:   29.90 |--------------------| 0.0%  - val_loss:  640.22 - val_cvae_loss:  625.31 - val_prototype_loss:   14.91 - val_labeled_loss:   29.82 |--------------------| 0.0%  - val_loss:  645.07 - val_cvae_loss:  630.29 - val_prototype_loss:   14.78 - val_labeled_loss:   29.57 |--------------------| 0.0%  - val_loss:  633.41 - val_cvae_loss:  618.99 - val_prototype_loss:   14.42 - val_labeled_loss:   28.83 |--------------------| 0.0%  - val_loss:  627.16 - val_cvae_loss:  612.78 - val_prototype_loss:   14.37 - val_labeled_loss:   28.75 |--------------------| 0.0%  - val_loss:  699.52 - val_cvae_loss:  685.06 - val_prototype_loss:   14.46 - val_labeled_loss:   28.92 |--------------------| 0.0%  - val_loss:  614.75 - val_cvae_loss:  600.76 - val_prototype_loss:   14.00 - val_labeled_loss:   28.00 |--------------------| 0.0%  - val_loss:  693.13 - val_cvae_loss:  678.87 - val_prototype_loss:   14.26 - val_labeled_loss:   28.52 |--------------------| 0.0%  - val_loss:  621.84 - val_cvae_loss:  607.38 - val_prototype_loss:   14.46 - val_labeled_loss:   28.92 |--------------------| 0.0%  - val_loss:  693.92 - val_cvae_loss:  679.68 - val_prototype_loss:   14.24 - val_labeled_loss:   28.48 |--------------------| 0.0%  - val_loss:  615.04 - val_cvae_loss:  600.72 - val_prototype_loss:   14.32 - val_labeled_loss:   28.64 |--------------------| 0.0%  - val_loss:  637.57 - val_cvae_loss:  623.42 - val_prototype_loss:   14.15 - val_labeled_loss:   28.29 |--------------------| 0.0%  - val_loss:  631.35 - val_cvae_loss:  617.33 - val_prototype_loss:   14.02 - val_labeled_loss:   28.05 |--------------------| 0.0%  - val_loss:  621.57 - val_cvae_loss:  607.56 - val_prototype_loss:   14.01 - val_labeled_loss:   28.03 |--------------------| 0.0%  - val_loss:  623.91 - val_cvae_loss:  610.28 - val_prototype_loss:   13.63 - val_labeled_loss:   27.27
ADJUSTED LR
 |--------------------| 0.0%  - val_loss:  618.39 - val_cvae_loss:  604.71 - val_prototype_loss:   13.68 - val_labeled_loss:   27.36 |--------------------| 0.0%  - val_loss:  682.52 - val_cvae_loss:  669.51 - val_prototype_loss:   13.01 - val_labeled_loss:   26.01 |--------------------| 0.0%  - val_loss:  626.44 - val_cvae_loss:  613.16 - val_prototype_loss:   13.28 - val_labeled_loss:   26.57 |--------------------| 0.0%  - val_loss:  608.31 - val_cvae_loss:  595.72 - val_prototype_loss:   12.59 - val_labeled_loss:   25.18 |--------------------| 0.0%  - val_loss:  617.95 - val_cvae_loss:  605.28 - val_prototype_loss:   12.67 - val_labeled_loss:   25.34 |--------------------| 0.0%  - val_loss:  624.97 - val_cvae_loss:  612.41 - val_prototype_loss:   12.56 - val_labeled_loss:   25.11 |--------------------| 0.0%  - val_loss:  612.75 - val_cvae_loss:  600.45 - val_prototype_loss:   12.30 - val_labeled_loss:   24.60 |--------------------| 0.0%  - val_loss:  622.30 - val_cvae_loss:  609.88 - val_prototype_loss:   12.42 - val_labeled_loss:   24.83 |--------------------| 0.0%  - val_loss:  634.98 - val_cvae_loss:  622.85 - val_prototype_loss:   12.12 - val_labeled_loss:   24.25 |--------------------| 0.0%  - val_loss:  668.56 - val_cvae_loss:  656.57 - val_prototype_loss:   12.00 - val_labeled_loss:   23.99 |--------------------| 0.0%  - val_loss:  613.49 - val_cvae_loss:  601.57 - val_prototype_loss:   11.92 - val_labeled_loss:   23.84 |--------------------| 0.0%  - val_loss:  618.36 - val_cvae_loss:  606.60 - val_prototype_loss:   11.75 - val_labeled_loss:   23.51 |--------------------| 0.0%  - val_loss:  707.27 - val_cvae_loss:  695.26 - val_prototype_loss:   12.01 - val_labeled_loss:   24.02 |--------------------| 0.0%  - val_loss:  603.70 - val_cvae_loss:  591.90 - val_prototype_loss:   11.80 - val_labeled_loss:   23.59 |--------------------| 0.0%  - val_loss:  620.29 - val_cvae_loss:  608.63 - val_prototype_loss:   11.66 - val_labeled_loss:   23.32 |--------------------| 0.0%  - val_loss:  701.31 - val_cvae_loss:  689.71 - val_prototype_loss:   11.61 - val_labeled_loss:   23.21 |--------------------| 0.0%  - val_loss:  635.89 - val_cvae_loss:  624.37 - val_prototype_loss:   11.52 - val_labeled_loss:   23.04 |--------------------| 0.0%  - val_loss:  661.81 - val_cvae_loss:  650.42 - val_prototype_loss:   11.39 - val_labeled_loss:   22.78 |--------------------| 0.0%  - val_loss:  619.99 - val_cvae_loss:  608.52 - val_prototype_loss:   11.46 - val_labeled_loss:   22.93 |--------------------| 0.0%  - val_loss:  614.37 - val_cvae_loss:  602.95 - val_prototype_loss:   11.42 - val_labeled_loss:   22.84 |--------------------| 0.0%  - val_loss:  665.98 - val_cvae_loss:  654.48 - val_prototype_loss:   11.50 - val_labeled_loss:   23.00 |--------------------| 0.0%  - val_loss:  690.49 - val_cvae_loss:  679.10 - val_prototype_loss:   11.39 - val_labeled_loss:   22.79 |--------------------| 0.0%  - val_loss:  616.00 - val_cvae_loss:  604.48 - val_prototype_loss:   11.52 - val_labeled_loss:   23.03 |--------------------| 0.0%  - val_loss:  613.69 - val_cvae_loss:  602.43 - val_prototype_loss:   11.26 - val_labeled_loss:   22.52 |--------------------| 0.0%  - val_loss:  621.54 - val_cvae_loss:  610.15 - val_prototype_loss:   11.39 - val_labeled_loss:   22.78 |--------------------| 0.0%  - val_loss:  612.24 - val_cvae_loss:  601.05 - val_prototype_loss:   11.20 - val_labeled_loss:   22.39 |--------------------| 0.0%  - val_loss:  621.95 - val_cvae_loss:  610.57 - val_prototype_loss:   11.38 - val_labeled_loss:   22.76 |--------------------| 0.0%  - val_loss:  630.48 - val_cvae_loss:  619.19 - val_prototype_loss:   11.29 - val_labeled_loss:   22.58
ADJUSTED LR
 |--------------------| 0.0%  - val_loss:  625.64 - val_cvae_loss:  614.37 - val_prototype_loss:   11.27 - val_labeled_loss:   22.54 |--------------------| 0.0%  - val_loss:  655.42 - val_cvae_loss:  644.12 - val_prototype_loss:   11.31 - val_labeled_loss:   22.61 |--------------------| 0.0%  - val_loss:  619.58 - val_cvae_loss:  608.49 - val_prototype_loss:   11.10 - val_labeled_loss:   22.19 |--------------------| 0.0%  - val_loss:  611.82 - val_cvae_loss:  600.47 - val_prototype_loss:   11.35 - val_labeled_loss:   22.71 |--------------------| 0.0%  - val_loss:  607.15 - val_cvae_loss:  595.90 - val_prototype_loss:   11.26 - val_labeled_loss:   22.51 |--------------------| 0.0%  - val_loss:  617.48 - val_cvae_loss:  606.11 - val_prototype_loss:   11.37 - val_labeled_loss:   22.74 |--------------------| 0.0%  - val_loss:  615.84 - val_cvae_loss:  604.58 - val_prototype_loss:   11.26 - val_labeled_loss:   22.52/ictstr01/home/icb/tim.treis/projects/broad_integrate/2023_Arevalo_BatchCorrection/env_store/d3de40dfaab7995cc62fa81880f86a90_/lib/python3.9/site-packages/scarches/models/scpoli/scpoli_model.py:347: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at /home/conda/feedstock_root/build_artifacts/pytorch-recipe_1699085588626/work/torch/csrc/utils/tensor_new.cpp:245.)
  c = torch.tensor(label_tensor, device=device).T

Stopping early: no improvement of more than 0 nats in 20 epochs
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
      Metadata_Source Metadata_Plate  ... Metadata_Column Metadata_Microscope
0            source_2     1053597936  ...              01              CV8000
1            source_2     1053597936  ...              22              CV8000
2            source_2     1053597936  ...              21              CV8000
3            source_2     1053597936  ...              20              CV8000
4            source_2     1053597936  ...              19              CV8000
...               ...            ...  ...             ...                 ...
11887        source_6   110000297122  ...              03              CV8000
11888        source_6   110000297122  ...              02              CV8000
11889        source_6   110000297122  ...              01              CV8000
11890        source_6   110000297122  ...              23              CV8000
11891        source_6   110000297122  ...              24              CV8000

[11892 rows x 10 columns] (11892, 30) ['scpoli_0', 'scpoli_1', 'scpoli_2', 'scpoli_3', 'scpoli_4', 'scpoli_5', 'scpoli_6', 'scpoli_7', 'scpoli_8', 'scpoli_9', 'scpoli_10', 'scpoli_11', 'scpoli_12', 'scpoli_13', 'scpoli_14', 'scpoli_15', 'scpoli_16', 'scpoli_17', 'scpoli_18', 'scpoli_19', 'scpoli_20', 'scpoli_21', 'scpoli_22', 'scpoli_23', 'scpoli_24', 'scpoli_25', 'scpoli_26', 'scpoli_27', 'scpoli_28', 'scpoli_29'] outputs/scenario_6/mad_int_featselect_scpoli.parquet
