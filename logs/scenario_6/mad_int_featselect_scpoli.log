WARNING:root:In order to use the mouse gastrulation seqFISH datsets, please install squidpy (see https://github.com/scverse/squidpy).
WARNING:root:In order to use sagenet models, please install pytorch geometric (see https://pytorch-geometric.readthedocs.io) and 
 captum (see https://github.com/pytorch/captum).
WARNING:root:mvTCR is not installed. To use mvTCR models, please install it first using "pip install mvtcr"
WARNING:root:multigrate is not installed. To use multigrate models, please install it first using "pip install multigrate".
INFO:scarches.trainers.scpoli.trainer:GPU available: True, GPU used: True
Embedding dictionary:
 	Num conditions: [2, 23]
 	Embedding dim: [5, 5]
Encoder Architecture:
	Input Layer in, out and cond: 1014 128 10
	Mean/Var Layer in/out: 128 30
Decoder Architecture:
	First Layer in, out and cond:  30 128 10
	Output Layer in/out:  128 1014 

Initializing dataloaders
Starting training
 |--------------------| 0.0%  - val_loss:  830.54 - val_cvae_loss:  830.54 |--------------------| 0.0%  - val_loss:  736.37 - val_cvae_loss:  736.37 |--------------------| 0.0%  - val_loss:  718.56 - val_cvae_loss:  718.56 |--------------------| 0.0%  - val_loss:  737.71 - val_cvae_loss:  737.71 |--------------------| 0.0%  - val_loss:  678.21 - val_cvae_loss:  678.21 |--------------------| 0.0%  - val_loss:  653.57 - val_cvae_loss:  653.57 |--------------------| 0.0%  - val_loss:  674.69 - val_cvae_loss:  674.69 |--------------------| 0.0%  - val_loss:  633.34 - val_cvae_loss:  633.34 |--------------------| 0.0%  - val_loss: 1290.87 - val_cvae_loss: 1290.87 |--------------------| 0.0%  - val_loss:  650.60 - val_cvae_loss:  650.60 |--------------------| 0.0%  - val_loss:  743.27 - val_cvae_loss:  743.27 |--------------------| 0.0%  - val_loss:  649.22 - val_cvae_loss:  649.22 |--------------------| 0.0%  - val_loss:  655.74 - val_cvae_loss:  655.74 |--------------------| 0.0%  - val_loss:  778.64 - val_cvae_loss:  778.64 |--------------------| 0.0%  - val_loss:  675.35 - val_cvae_loss:  675.35 |--------------------| 0.0%  - val_loss:  629.77 - val_cvae_loss:  629.77 |--------------------| 0.0%  - val_loss:  617.13 - val_cvae_loss:  617.13 |--------------------| 0.0%  - val_loss:  617.18 - val_cvae_loss:  617.18 |--------------------| 0.0%  - val_loss:  651.82 - val_cvae_loss:  651.82 |--------------------| 0.0%  - val_loss:  645.52 - val_cvae_loss:  645.52 |--------------------| 0.0%  - val_loss:  617.63 - val_cvae_loss:  617.63 |--------------------| 0.0%  - val_loss:  628.30 - val_cvae_loss:  628.30 |--------------------| 0.0%  - val_loss:  608.31 - val_cvae_loss:  608.31 |--------------------| 0.0%  - val_loss:  619.70 - val_cvae_loss:  619.70 |--------------------| 0.0%  - val_loss:  642.02 - val_cvae_loss:  642.02 |--------------------| 0.0%  - val_loss:  692.50 - val_cvae_loss:  623.03 - val_prototype_loss:   69.48 - val_labeled_loss:  138.95 |--------------------| 0.0%  - val_loss:  670.65 - val_cvae_loss:  623.59 - val_prototype_loss:   47.06 - val_labeled_loss:   94.12 |--------------------| 0.0%  - val_loss:  754.51 - val_cvae_loss:  717.78 - val_prototype_loss:   36.72 - val_labeled_loss:   73.44 |--------------------| 0.0%  - val_loss:  696.60 - val_cvae_loss:  666.65 - val_prototype_loss:   29.95 - val_labeled_loss:   59.90 |--------------------| 0.0%  - val_loss:  664.62 - val_cvae_loss:  638.69 - val_prototype_loss:   25.92 - val_labeled_loss:   51.85 |--------------------| 0.0%  - val_loss:  653.05 - val_cvae_loss:  629.77 - val_prototype_loss:   23.28 - val_labeled_loss:   46.57 |--------------------| 0.0%  - val_loss:  656.02 - val_cvae_loss:  633.95 - val_prototype_loss:   22.07 - val_labeled_loss:   44.13 |--------------------| 0.0%  - val_loss:  637.43 - val_cvae_loss:  617.67 - val_prototype_loss:   19.77 - val_labeled_loss:   39.54 |--------------------| 0.0%  - val_loss:  655.97 - val_cvae_loss:  636.79 - val_prototype_loss:   19.19 - val_labeled_loss:   38.37 |--------------------| 0.0%  - val_loss:  715.36 - val_cvae_loss:  696.73 - val_prototype_loss:   18.63 - val_labeled_loss:   37.26 |--------------------| 0.0%  - val_loss:  651.85 - val_cvae_loss:  633.98 - val_prototype_loss:   17.87 - val_labeled_loss:   35.73 |--------------------| 0.0%  - val_loss:  685.72 - val_cvae_loss:  668.97 - val_prototype_loss:   16.75 - val_labeled_loss:   33.50 |--------------------| 0.0%  - val_loss:  637.97 - val_cvae_loss:  621.50 - val_prototype_loss:   16.48 - val_labeled_loss:   32.95 |--------------------| 0.0%  - val_loss:  644.73 - val_cvae_loss:  628.28 - val_prototype_loss:   16.46 - val_labeled_loss:   32.91 |--------------------| 0.0%  - val_loss:  891.81 - val_cvae_loss:  875.77 - val_prototype_loss:   16.05 - val_labeled_loss:   32.10 |--------------------| 0.0%  - val_loss:  631.37 - val_cvae_loss:  615.85 - val_prototype_loss:   15.53 - val_labeled_loss:   31.05 |--------------------| 0.0%  - val_loss:  638.91 - val_cvae_loss:  623.49 - val_prototype_loss:   15.41 - val_labeled_loss:   30.83 |--------------------| 0.0%  - val_loss:  637.21 - val_cvae_loss:  621.90 - val_prototype_loss:   15.31 - val_labeled_loss:   30.62 |--------------------| 0.0%  - val_loss:  651.31 - val_cvae_loss:  636.38 - val_prototype_loss:   14.93 - val_labeled_loss:   29.86 |--------------------| 0.0%  - val_loss:  633.33 - val_cvae_loss:  618.67 - val_prototype_loss:   14.67 - val_labeled_loss:   29.33 |--------------------| 0.0%  - val_loss:  629.83 - val_cvae_loss:  615.16 - val_prototype_loss:   14.67 - val_labeled_loss:   29.35 |--------------------| 0.0%  - val_loss:  661.74 - val_cvae_loss:  646.83 - val_prototype_loss:   14.91 - val_labeled_loss:   29.81 |--------------------| 0.0%  - val_loss:  639.55 - val_cvae_loss:  624.95 - val_prototype_loss:   14.60 - val_labeled_loss:   29.21 |--------------------| 0.0%  - val_loss:  642.15 - val_cvae_loss:  627.41 - val_prototype_loss:   14.74 - val_labeled_loss:   29.48 |--------------------| 0.0%  - val_loss:  639.46 - val_cvae_loss:  625.26 - val_prototype_loss:   14.20 - val_labeled_loss:   28.40 |--------------------| 0.0%  - val_loss:  654.02 - val_cvae_loss:  639.75 - val_prototype_loss:   14.27 - val_labeled_loss:   28.55 |--------------------| 0.0%  - val_loss:  636.73 - val_cvae_loss:  622.53 - val_prototype_loss:   14.19 - val_labeled_loss:   28.39 |--------------------| 0.0%  - val_loss:  638.31 - val_cvae_loss:  624.19 - val_prototype_loss:   14.12 - val_labeled_loss:   28.23 |--------------------| 0.0%  - val_loss:  680.03 - val_cvae_loss:  665.92 - val_prototype_loss:   14.11 - val_labeled_loss:   28.22 |--------------------| 0.0%  - val_loss:  632.61 - val_cvae_loss:  619.03 - val_prototype_loss:   13.57 - val_labeled_loss:   27.15 |--------------------| 0.0%  - val_loss:  634.07 - val_cvae_loss:  620.35 - val_prototype_loss:   13.72 - val_labeled_loss:   27.44 |--------------------| 0.0%  - val_loss:  721.55 - val_cvae_loss:  707.70 - val_prototype_loss:   13.84 - val_labeled_loss:   27.68 |--------------------| 0.0%  - val_loss:  641.44 - val_cvae_loss:  627.96 - val_prototype_loss:   13.48 - val_labeled_loss:   26.95 |--------------------| 0.0%  - val_loss:  681.45 - val_cvae_loss:  667.60 - val_prototype_loss:   13.85 - val_labeled_loss:   27.70 |--------------------| 0.0%  - val_loss:  639.95 - val_cvae_loss:  626.13 - val_prototype_loss:   13.83 - val_labeled_loss:   27.66
ADJUSTED LR
 |--------------------| 0.0%  - val_loss:  714.83 - val_cvae_loss:  701.42 - val_prototype_loss:   13.41 - val_labeled_loss:   26.82 |--------------------| 0.0%  - val_loss:  652.52 - val_cvae_loss:  639.38 - val_prototype_loss:   13.13 - val_labeled_loss:   26.26 |--------------------| 0.0%  - val_loss:  640.12 - val_cvae_loss:  627.28 - val_prototype_loss:   12.84 - val_labeled_loss:   25.68 |--------------------| 0.0%  - val_loss:  649.19 - val_cvae_loss:  636.54 - val_prototype_loss:   12.65 - val_labeled_loss:   25.31 |--------------------| 0.0%  - val_loss:  635.52 - val_cvae_loss:  622.93 - val_prototype_loss:   12.58 - val_labeled_loss:   25.17 |--------------------| 0.0%  - val_loss:  638.15 - val_cvae_loss:  626.09 - val_prototype_loss:   12.07 - val_labeled_loss:   24.14 |--------------------| 0.0%  - val_loss:  622.68 - val_cvae_loss:  610.42 - val_prototype_loss:   12.26 - val_labeled_loss:   24.52/ictstr01/home/icb/tim.treis/projects/broad_integrate/2023_Arevalo_BatchCorrection/env_store/d3de40dfaab7995cc62fa81880f86a90_/lib/python3.9/site-packages/scarches/models/scpoli/scpoli_model.py:347: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at /home/conda/feedstock_root/build_artifacts/pytorch-recipe_1699085588626/work/torch/csrc/utils/tensor_new.cpp:245.)
  c = torch.tensor(label_tensor, device=device).T

Stopping early: no improvement of more than 0 nats in 20 epochs
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
      Metadata_Source Metadata_Plate  ... Metadata_Column Metadata_Microscope
0            source_2     1053597936  ...              01              CV8000
1            source_2     1053597936  ...              22              CV8000
2            source_2     1053597936  ...              21              CV8000
3            source_2     1053597936  ...              20              CV8000
4            source_2     1053597936  ...              19              CV8000
...               ...            ...  ...             ...                 ...
11887        source_6   110000297122  ...              03              CV8000
11888        source_6   110000297122  ...              02              CV8000
11889        source_6   110000297122  ...              01              CV8000
11890        source_6   110000297122  ...              23              CV8000
11891        source_6   110000297122  ...              24              CV8000

[11892 rows x 10 columns] (11892, 30) ['scpoli_0', 'scpoli_1', 'scpoli_2', 'scpoli_3', 'scpoli_4', 'scpoli_5', 'scpoli_6', 'scpoli_7', 'scpoli_8', 'scpoli_9', 'scpoli_10', 'scpoli_11', 'scpoli_12', 'scpoli_13', 'scpoli_14', 'scpoli_15', 'scpoli_16', 'scpoli_17', 'scpoli_18', 'scpoli_19', 'scpoli_20', 'scpoli_21', 'scpoli_22', 'scpoli_23', 'scpoli_24', 'scpoli_25', 'scpoli_26', 'scpoli_27', 'scpoli_28', 'scpoli_29'] outputs/scenario_6/mad_int_featselect_scpoli.parquet
